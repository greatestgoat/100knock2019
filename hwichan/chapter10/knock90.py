import word2vec
import numpy as np
from collections import OrderedDict
from scipy import io
import pickle


def main():
    # size: 次元, threds: スレッド数, binary: 出力する形式を指定、0でテキスト形式で出力
    word2vec.word2vec(train='out_rename.txt', output='knock90.txt',
                      size=300, threads=4, binary=0)

    t_index = OrderedDict()  # 単語：インデックス の辞書

    with open('knock90.txt', 'rt') as f:
        for i, line in enumerate(f):
            line = line.strip().split(' ')

            if i == 0:  # １行目が語彙数と次元数
                words_count = int(line[0])
                size = int(line[1])
                # 行列の作成
                matrix_90 = np.zeros([words_count, size], dtype=np.float64)
                continue

            # たまに次元数が３００以下のときがある
            if len(line[1:]) < 300:
                continue

            word = line[0]
            t_index[word] = i - 1

            matrix_90[i - 1] = line[1:]

    io.savemat('knock90_300', {'knock90_300': matrix_90})
    with open('./pickles/knock90_idx_t', 'wb') as f:
        pickle.dump(t_index, f)


if __name__ == "__main__":
    main()


# knock86
# [ 0.082076 -0.042789  0.112858  0.246593 -0.154682 -0.11276   0.126598
#  -0.100033 -0.038463  0.321294 -0.02039   0.150975  0.168623 -0.10115
#  -0.232078  0.244038  0.244998 -0.229234  0.096706 -0.04071  -0.07197
#   0.360267 -0.235676 -0.168908  0.045485 -0.298738  0.3417    0.094176
#   0.071358  0.437074 -0.019623 -0.099738  0.162215  0.306459 -0.014907
#  -0.083946 -0.026537  0.127391 -0.010197 -0.159146  0.084532  0.145
#   0.16497   0.052855 -0.052487 -0.085064  0.017512 -0.07133   0.003916
#   0.019979  0.213514 -0.13602  -0.186441 -0.012618  0.238883 -0.127104
#  -0.130682 -0.148092  0.030302  0.09702  -0.062642  0.140466  0.04345
#   0.105845 -0.030848  0.133349  0.17034   0.003871 -0.290286  0.116966
#   0.00663   0.233644 -0.034123 -0.104995 -0.165734 -0.022221  0.024322
#  -0.080206 -0.032147  0.045256 -0.107744  0.179169 -0.118517 -0.037533
#   0.145632 -0.218019  0.181589 -0.013607  0.283942 -0.050755  0.055726
#  -0.210864 -0.373201  0.233718  0.008981 -0.006952 -0.075279  0.069564
#   0.015758 -0.003333  0.163472 -0.110807 -0.232093 -0.109885  0.250579
#   0.002529  0.038783  0.188461 -0.231533  0.030976  0.28918  -0.101436
#   0.080099 -0.031126 -0.152076  0.040158 -0.051039  0.242369 -0.023664
#   0.035165  0.229444  0.154235  0.087419 -0.041433  0.256682 -0.123853
#  -0.249442  0.010683 -0.160457 -0.191685  0.124466  0.02286  -0.094377
#   0.149042 -0.356728  0.132574  0.059053  0.060925 -0.093527  0.200313
#  -0.083885  0.075523  0.022101  0.129133 -0.059264 -0.003903  0.152251
#   0.260626 -0.04231  -0.200543 -0.211058 -0.108622  0.131401  0.285984
#  -0.052476 -0.08783   0.398091  0.174992 -0.046449  0.024142  0.138734
#  -0.074976 -0.1021   -0.060477 -0.004628 -0.062614 -0.168298 -0.046343
#   0.141968 -0.134392 -0.057817  0.004318  0.251922  0.021861 -0.180565
#   0.281645  0.130339  0.148994 -0.083705 -0.013854 -0.037442  0.006334
#  -0.125962 -0.140889 -0.028051  0.0779   -0.166285 -0.151561  0.112682
#  -0.135087  0.128093 -0.01947   0.049252 -0.165079  0.066238  0.275107
#  -0.1843    0.279664 -0.222094 -0.127796 -0.039005 -0.027849  0.180067
#  -0.294879  0.088475  0.047816 -0.187146 -0.091586 -0.251145  0.192479
#  -0.107768  0.192969 -0.134142 -0.262469 -0.088862  0.030368 -0.088061
#   0.20488  -0.07655   0.151625  0.357624  0.111894  0.079115  0.126023
#  -0.074538  0.239476  0.083105 -0.158491  0.090617  0.035094 -0.088624
#  -0.036085 -0.242573 -0.004116  0.095601 -0.052167  0.052868  0.04854
#   0.015661 -0.256676  0.40484   0.192936 -0.038217 -0.043172 -0.203109
#   0.282897  0.09239  -0.041257  0.002557 -0.010802  0.167101 -0.473083
#   0.131492  0.091295 -0.312789  0.083168  0.477479  0.083973 -0.077008
#   0.066314  0.178043  0.079686  0.235226  0.05549  -0.03288  -0.126623
#  -0.005165 -0.093837  0.482728  0.184841 -0.400717 -0.058777  0.040289
#  -0.316993  0.318902 -0.364581 -0.149613  0.17174  -0.177009  0.041751
#   0.223313 -0.031796  0.141091 -0.033106 -0.136485  0.135118 -0.075835
#  -0.246016  0.039096 -0.316446  0.229338 -0.27407   0.11287   0.115248
#   0.510776  0.103842  0.121434  0.142712 -0.170818  0.059214]

# knock87
# 0.6768456229568789

# knock88
# Scotland 0.7422886853536774
# Wales 0.7413368875417246
# Ireland 0.6380172509824709
# Britain 0.615737053870946
# Sweden 0.5961812340537311
# Italy 0.581379990690363
# London 0.5698229979272216
# Germany 0.5636496912311596
# Hampshire 0.5634653758330134
# Australia 0.5595421829405395

# knock89
# Spain 0.9103431226666532
# Italy 0.8435092611863773
# Portugal 0.8311151590165786
# Austria 0.8291044546378402
# Russia 0.8138155156832084
# Denmark 0.8111736192990293
# Egypt 0.8042357542971401
# Greece 0.8028476233463758
# Poland 0.78626919483441
# Belgium 0.7855976073294207
